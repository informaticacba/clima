<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Cambio Climatico</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

	<!-- Font Awesome -->
	<link href="css/font-awesome.min.css" rel="stylesheet">

	<!-- Responsive Tabs Style -->
    <link type="text/css" rel="stylesheet" href="css/responsive-tabs.css" />
    <link type="text/css" rel="stylesheet" href="css/tabs_style.css" />
    <link href="css/c3.css" rel="stylesheet" type="text/css">    
	<link href="css/opiscatter.css" rel="stylesheet" type="text/css">

    <!-- Custom styles for this template -->
    <link href="css/main_style.css" rel="stylesheet">

    <!-- Leaflet -->
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
    

    <style>
		#map {
			width: auto;
			height: 500px;
		}

		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}

		.legend {
			text-align: left;
			line-height: 18px;
			color: #555;
		}
		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 8px;
			opacity: 0.7;
		}
	</style>
  </head>

  <body>

   	<!--div class="blog-masthead">
      <div class="container">
        <nav class="blog-nav">
          <a class="blog-nav-item" href="#"><i class="fa fa-tasks"></i> datos.gob.mx</a>
          <a class="blog-nav-item" href="#">Datos</a>
          <a class="blog-nav-item" href="#">Herramientas</a>
          <a class="blog-nav-item" href="#">Impacto</a>
          <a class="blog-nav-item" href="#">Guía</a>
          <a class="blog-nav-item" href="#">Acerca</a>
          <a class="blog-nav-item" href="#"><i class="fa fa-github-square"></i></a>                    
        </nav>
      </div>
    </div-->

    <div class="container-clima">
		<div class="row">
			<div id="responsiveTabsContainer">
	
			    <ul>
			        <li class="title-tab"><p class="text-size-14"> Cambio Climático </p></li>
			        <li class="normal-tab" id="main-tab"><a href="#tab-2"><strong>¿Qué es? </strong></a></li>
			        <li class="normal-tab"><a href="#tab-3"><strong>¿Por qué pasa?</strong> </a></li>
			        <li class="normal-tab"><a href="#tab-4"><strong>¿Cómo me afecta?</strong> </a></li>
			        <li class="normal-tab"><a href="#tab-5"><strong> Acciones</strong> </a></li>                
			    </ul>
			
			    <div id="tab-2">
				    
				    <div class="row">
					    <div class="col-xs-8">
						    <p class="black-text">
							    Los Científicos definen el cambio climático como "...todo cambio que ocurre en la cima a través del tiempo resultado de la variabilidad neutral o de las actividades humanas." El calentamiento global por su parte, es la manifestación más evidente del cambio climático y se refiere al incremento promedio de las temperaturas terrestres y marinas globales.
						    </p>
						    <br>
						    <p class="text-center"><strong>Inventario Nacional de la emisión de gases de efecto invernadero</strong></p>
						    <!--img class="img-responsive" src="img/g1.png"/-->
							<div id="chart1" style="width:350px;"></div>						    
						</div>    
					    <div class="col-xs-4" id="green-boxes">
						    
						</div>
				    </div>
				    <br>
				    <!-- Indicadores -->
				    <p style="font-size: 20px;">Indicadores</p>
				    <div class="row">
						<div class="text-center indicator-box-red col-xs-3 custom-tooltip" data-toggle="tooltip" data-placement="top" title="Lorem Ipsum Bacon Auditore">
							<h1>390%</h1>
							<p class="text-size-12">Más emisiones globales que en 1960.</p>
						</div>	
						<div class="text-center indicator-box-green col-xs-3 custom-tooltip" data-toggle="tooltip" data-placement="top" title="Lorem Ipsum Bacon Auditore">
							<h1>30%</h1>
							<p class="text-size-12"> Menos tala de árboles que en 1960</p>	
						</div>								
						<div class="text-center indicator-box-green col-xs-3 custom-tooltip" data-toggle="tooltip" data-placement="top" title="Lorem Ipsum Bacon Auditore">
							<h1></h1>
							<p class="text-size-12"></p>
						</div>	
						<div class="text-center indicator-box-red col-xs-3 custom-tooltip" data-toggle="tooltip" data-placement="top" title="Lorem Ipsum Bacon Auditore">
							<h1></h1>
							<p class="text-size-12"></p>
						</div>	
						<div class="text-center indicator-box-green col-xs-3 custom-tooltip" data-toggle="tooltip" data-placement="top" title="Lorem Ipsum Bacon Auditore">
							<h1></h1>
							<p class="text-size-12"></p>
						</div>							
					</div>    
				    
<div class="row">
					    <div class="data-table-container">
						    <h4 class="aqua-text"><strong>Datos</strong></h4>
						    <table class="bottom-table">
							    <tr>
								    <td style="width: 40%; padding-left:20px"><p class="text-size-12"><strong>Nombre</strong></p></td>
								    <td style="width: 15%"><p class="text-size-12"><strong>Dependencia</strong></p></td>
								    <td style="width: 15%"><p class="text-size-12"><strong>Fecha</strong></p></td>
								    <td style="width: 15%"><p class="text-size-12"><strong>Formato</strong></p></td>
								    <td style="width: 15%"><strong></strong></td>
							    </tr>
								<tr class="name-info">
								    <td style="padding-left:20px">
									    <p style="font-size: 10px; padding-right: 16px;"><strong>Rezago habitacional por condiciones de espacio, materiales e instalaciones de la vivienda</strong></p>
									</td>    
								    <td>
									    SEDATU
									</td>    
									<td>
									    N/A 
									</td>  
								    <td>
										<span class="format-text">CSV</span>
									</td>  
								    <td class="download-col">
									    <div class="center-block" style="border-radius:50%; background-color:#979494; width: 42px;">
											<h1 style="font-size: 20px; padding: 10px;" class="text-center"><i class="fa fa-download"></i><h1>
										</div>
									</td>
								</tr>
							    <tr>
								    <td style="width: 40%; padding-left:20px; padding-right: 5px;">
									    <br>
									    <p class="text-size-12"><strong>Descripción</strong></p>
									    <p style="font-size: 11px; padding-right: 24px; text-align: justify;">Una vivienda se encuentra en rezago habitacional cuando no cumple con las condiciones mínimas de espacio, materiales e instalaciones necesarias para garantizar el pleno desarrollo de sus habitantes y el numero de cuartos es mayor a 2.5. Una vivienda está en rezago habitacional por materiales cuando el piso es de tierra los muros son de material de desecho, la lámina de cartón, de lámina de asbesto o metálica, de carrizo, bambú o palma, de embarro o bajareque, o de madera o tejamanil. Una vivienda está en rezago habitacional por instalaciones de cocina cuando el principal combustible utilizado para cocinar es leña o carbón y no se cuenta con chimenea. Una vivienda está en rezago habitacional por instalaciones sanitarias cuando no cuenta con excusado, retrete, sanitario, letrina u hoyo negro, de uso excesivo (no se compare con otra vivienda) al que se le pueda echar agua mediante descarga directa o con cubetas</p>
									</td>
								    <td style="width: 15%">
									    <p class="text-size-12">
										    <strong>Desagregación</strong>
										</p>
										<p class="text-size-12">
											Nacional;Estatal
										</p>
									</td>
								    <td style="width: 15%">
									    <p class="text-size-12"><strong>Desagregación<br> Temporal</strong></p>
									    <p class="text-size-12">Anual</p>									    
								    </td>
								    <td style="width: 15%">
									    <p class="text-size-12"><strong>Años</strong></p>
									    <p class="text-size-12">2014.0</p>									    
									    <p class="aqua-text text-size-12">MÁS INFORMACIÓN</p>
									</td>
								    <td style="width: 15%"></td>
							    </tr>
						    </table>
					    </div>
				    </div>
				    				    
				</div>
			    
			    <div id="tab-3"> 
				    <p class="black-text">
					    El cambio climático que hoy enfrentamos está vinculado a la quema de combustibles fósiles, especialmente el carbón, gas y petróleo, y a la deforestación, es decir, a la pérdida de cobertura forestal. Ambos fenómenos tienen como consecuencia la excesiva emisión a la atmósfera de gases de efecto invernadero (GEI), mismos que están incrementando la temperatura del planeta
				    </p>
				    <p>
				    	Emisiones de carbono (Co2) por sector de la economía
					</p>    
					<div class="row">
						<div class="col-xs-12">
						    <!--img class="img-responsive" src="img/g2.png"/-->
							<div id="chart"></div>
						</div>	
					</div>	
					<p>Explora</p>
					<p>
						Selecciona un indicador: 
						<select id="opciones">
						  <option value="1">Opcion 1</option>
						  <option value="2">Opcion 2</option>
						  <option value="3">Opcion 3</option>						  						  
						</select>
					</p>					
					<div class="row">
						<div class="col-xs-12">
						    <img class="img-responsive" src="img/g3.png"/>							
						</div>	
					</div>
					<div class="row">
						<div class="col-xs-12">
							<div id="map"></div>
						</div>
					</div>						
					<div class="row">
						<div class="col-xs-2" id="anio2010">
							<p class="text-center map-year"><strong>2010</strong></p>
						</div>	
						<div class="col-xs-2" id="anio2011">
							<p class="text-center map-year"><strong>2011</strong></p>
						</div>	
						<div class="col-xs-2" id="anio2012">
							<p class="text-center map-year"><strong>2012</strong></p>
						</div>	
						<div class="col-xs-2" id="anio2013">
							<p class="text-center map-year"><strong>2013</strong></p>
						</div>	
						<div class="col-xs-2" id="anio2014">
							<p class="text-center map-year"><strong>2014</strong></p>
						</div>	
						<div class="col-xs-2" id="anio2015">
							<p class="text-center map-year aqua-text"><strong>2015</strong></p>
						</div>																									
					</div>
				    <!-- Data table-->
				    <div class="row">
					    <div class="data-table-container">
						    <h4 class="aqua-text"><strong>Datos</strong></h4>
						    <table class="bottom-table">
							    <tr>
								    <td style="width: 40%; padding-left:20px"><p class="text-size-12"><strong>Nombre</strong></p></td>
								    <td style="width: 15%"><p class="text-size-12"><strong>Dependencia</strong></p></td>
								    <td style="width: 15%"><p class="text-size-12"><strong>Fecha</strong></p></td>
								    <td style="width: 15%"><p class="text-size-12"><strong>Formato</strong></p></td>
								    <td style="width: 15%"><strong></strong></td>
							    </tr>
								<tr class="name-info">
								    <td style="padding-left:20px;">
									    <p style="font-size: 10px; padding-right: 16px;"><strong>Rezago habitacional por condiciones de espacio, materiales e instalaciones de la vivienda</strong></p>
									</td>    
								    <td>
									    SEDATU
									</td>    
									<td>
									    N/A 
									</td>  
								    <td>
										<span class="format-text">CSV</span>
									</td>  
								    <td class="download-col">
										<div class="center-block" style="border-radius:50%; background-color:#979494; width: 42px;">
											<h1 style="font-size: 20px; padding: 10px;" class="text-center"><i class="fa fa-download"></i><h1>
										</div>
									</td>
								</tr>
							    <tr>
								    <td style="width: 40%; padding-left:20px; padding-right: 5px;">
									    <br>
									    <p class="text-size-12"><strong>Descripción</strong></p>
									    <p style="font-size: 11px; padding-right: 24px; text-align: justify;">Una vivienda se encuentra en rezago habitacional cuando no cumple con las condiciones mínimas de espacio, materiales e instalaciones necesarias para garantizar el pleno desarrollo de sus habitantes y el numero de cuartos es mayor a 2.5. Una vivienda está en rezago habitacional por materiales cuando el piso es de tierra los muros son de material de desecho, la lámina de cartón, de lámina de asbesto o metálica, de carrizo, bambú o palma, de embarro o bajareque, o de madera o tejamanil. Una vivienda está en rezago habitacional por instalaciones de cocina cuando el principal combustible utilizado para cocinar es leña o carbón y no se cuenta con chimenea. Una vivienda está en rezago habitacional por instalaciones sanitarias cuando no cuenta con excusado, retrete, sanitario, letrina u hoyo negro, de uso excesivo (no se compare con otra vivienda) al que se le pueda echar agua mediante descarga directa o con cubetas</p>
									</td>
								    <td style="width: 15%">
									    <p class="text-size-12">
										    <strong>Desagregación</strong>
										</p>
										<p class="text-size-12">
											Nacional;Estatal
										</p>
									</td>
								    <td style="width: 15%">
									    <p class="text-size-12"><strong>Desagregación<br> Temporal</strong></p>
									    <p class="text-size-12">Anual</p>									    
								    </td>
								    <td style="width: 15%">
									    <p class="text-size-12"><strong>Años</strong></p>
									    <p class="text-size-12">2014.0</p>									    
									    <p class="aqua-text text-size-12">MÁS INFORMACIÓN</p>
									</td>
								    <td style="width: 15%"></td>
							    </tr>
						    </table>
					    </div>
				    </div>

					
				</div>
			    
			    <div id="tab-4"> 
				    como afecta 
				</div>
			    
			    <div id="tab-5"> 
					<style>
					
					#chart-tree {
					  width: 960px;
					  height: 500px;
					  background: #ddd;
					}
					
					text {
					  pointer-events: none;
					}
					
					.grandparent text {
					  font-weight: bold;
					}
					
					rect {
					  fill: none;
					  stroke: #fff;
					}
					
					rect.parent,
					.grandparent rect {
					  stroke-width: 2px;
					}
					
					.grandparent rect {
					  fill: orange;
					}
					
					.grandparent:hover rect {
					  fill: #ee9700;
					}
					
					.children rect.parent,
					.grandparent rect {
					  cursor: pointer;
					}
					
					.children rect.parent {
					  fill: #bbb;
					  fill-opacity: .5;
					}
					
					.children:hover rect.child {
					  fill: #bbb;
					}
					
					</style>				    
					<p id="chart-tree">
				</div>    

			</div>
		</div>	
    </div><!-- /.container -->

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!--script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script-->
    
    <script src="js/jquery-1.11.0.min.js"></script>    
    <script src="js/bootstrap.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>    
    <script src="js/c3.js"></script>
	<script type="text/javascript" src="js/scatter001.js"></script>						    							
    <script src="js/csvjson.js"></script>    

	<!-- Responsive Tabs JS -->
	<script src="js/jquery.responsiveTabs.js" type="text/javascript"></script>

	<!-- Leaflet -->
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<!--script src="js/states_temp_2by2.js" type="text/javascript"></script-->
	
	<script type="text/javascript">

		var estados;
		var anio = 25;
		var op = 1;


		$('#anio2010').click(function() {
			anio = 20;
			if($('#opciones').val() == 1) {
				pintarMapa();		
			} else if($('#opciones').val() == 2) {
				pintarMapa2();
			}
		});

		$('#anio2011').click(function() {
			anio = 21;
			if($('#opciones').val() == 1) {
				pintarMapa();		
			} else if($('#opciones').val() == 2) {
				pintarMapa2();
			}
		});

		$('#anio2012').click(function() {
			anio = 22;
			if($('#opciones').val() == 1) {
				pintarMapa();		
			} else if($('#opciones').val() == 2) {
				pintarMapa2();
			}
		});

		$('#anio2013').click(function() {
			anio = 23;
			if($('#opciones').val() == 1) {
				pintarMapa();		
			} else if($('#opciones').val() == 2) {
				pintarMapa2();
			}
		});

		$('#anio2014').click(function() {
			anio = 24;
			if($('#opciones').val() == 1) {
				pintarMapa();		
			} else if($('#opciones').val() == 2) {
				pintarMapa2();
			}
		});

		$('#anio2015').click(function() {
			anio = 25;
			if($('#opciones').val() == 1) {
				pintarMapa();		
			} else if($('#opciones').val() == 2) {
				pintarMapa2();
			}
		});

		$('#opciones').change(function() {

			if($(this).val() == 1) {
				pintarMapa();
			} else if($(this).val() == 2) {
				pintarMapa2();
			}

		});



		function pintarMapa() {
			function style1(feature) {
				return {
					weight: 2,
					opacity: 1,
					color: 'white',
					dashArray: '3',
					fillOpacity: 0.7,
					fillColor: getColor(feature.properties.indicador1[anio].valor)
				};
			}
			
			info.removeFrom(map);

			info.onAdd = function (map) {
				this._div = L.DomUtil.create('div', 'info');
				this.update();
				return this._div;
			}

			info.update = function (props) {
				this._div.innerHTML = '<h4>Valor</h4>' +  (props ?
					'<b>' + props.name + '</b><br /> valor: ' + props.indicador1[anio].valor
					: '');
			}

			info.addTo(map);

			map.removeLayer(geojson);

			geojson = L.geoJson(estados, {
				style: style1,
				onEachFeature: onEachFeature
			}).addTo(map);
		}


		function pintarMapa2() {
			function style2(feature) {
					return {
						weight: 2,
						opacity: 1,
						color: 'white',
						dashArray: '3',
						fillOpacity: 0.7,
						fillColor: getColor(feature.properties.indicador2[anio].valor)
					};
				}

				info.removeFrom(map);

				info.onAdd = function (map) {
					this._div = L.DomUtil.create('div', 'info');
					this.update();
					return this._div;
				}

				info.update = function (props) {
					this._div.innerHTML = '<h4>Valor</h4>' +  (props ?
						'<b>' + props.name + '</b><br /> valor: ' + props.indicador2[anio].valor
						: '');
				}

				info.addTo(map);

				map.removeLayer(geojson);

				geojson = L.geoJson(estados, {
					style: style2,
					onEachFeature: onEachFeature
				}).addTo(map);
		}



		$.ajax({
			//url: "data/states_temp.json",
			url: "data/states_temp_2by2.json",
			async: false,
			success: function(data){
				console.log(data);
				estados = data;
			},
			error: function(err) {
				console.log(err.responseText);
				estados = err.responseText;
			}
		});

		var map = L.map('map', {zoomControl: false}).setView([22.890674, -102.067944], 5);

		// Disable drag and zoom handlers.
		map.dragging.disable();
		map.touchZoom.disable();
		map.doubleClickZoom.disable();
		map.scrollWheelZoom.disable();

		// Disable tap handler, if present.
		if (map.tap) map.tap.disable();

		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ', {
			maxZoom: 18,
			id: 'mapbox.light'
		}).addTo(map);

		var info = L.control();

		info.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'info');
			this.update();
			return this._div;
		};

		info.update = function (props) {
			this._div.innerHTML = '<h4>Valor</h4>' +  (props ?
				'<b>' + props.name + '</b><br /> valor: ' + props.indicador1[anio].valor
				: '');
		};

		info.addTo(map);

		function getColor(d) {
			return d > 4000000 ? '#009975' :
			       d > 3500000  ? '#00b388' :
			       d > 3000000  ? '#00cc9c' :
			       d > 2500000  ? '#00ffc3' :
			       d > 2000000   ? '#33ffcf' :
			       d > 1500000   ? '#66ffdb' :
			       d > 1000000   ? '#99ffe7' :
			                  '#ccfff3';
		}

		function style(feature) {
			return {
				weight: 2,
				opacity: 1,
				color: 'white',
				dashArray: '3',
				fillOpacity: 0.7,
				fillColor: getColor(feature.properties.indicador1[anio].valor)
			};
		}

		function highlightFeature(e) {
			var layer = e.target;

			layer.setStyle({
				weight: 5,
				color: '#666',
				dashArray: '',
				fillOpacity: 0.7
			});

			if (!L.Browser.ie && !L.Browser.opera) {
				layer.bringToFront();
			}

			info.update(layer.feature.properties);
		}

		var geojson;

		function resetHighlight(e) {
			geojson.resetStyle(e.target);
			info.update();
		}

		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature(feature, layer) {
			layer.on({
				mouseover: highlightFeature,
				mouseout: resetHighlight
			});
		}

		geojson = L.geoJson(estados, {
			style: style,
			onEachFeature: onEachFeature
		}).addTo(map);



		var legend = L.control({position: 'bottomleft'});

		legend.onAdd = function (map) {

			var div = L.DomUtil.create('div', 'info legend'),
				grades = [0, 1000000, 1500000, 2000000, 2500000, 3500000, 4000000, 4500000],
				labels = [],
				from, to;

			for (var i = 0; i < grades.length; i++) {
				from = grades[i];
				to = grades[i + 1];

				labels.push(
					'<i style="background:' + getColor(from + 1) + '"></i> ' +
					from + (to ? '&ndash;' + to : '+'));
			}

			div.innerHTML = labels.join('<br>');
			return div;
		};

		legend.addTo(map);


		
		













		$('#responsiveTabsContainer').responsiveTabs({
		    startCollapsed: 'accordion',
		    active: 1
		});
		$("#main-tab").click();
		
		$(function () {
			$('[data-toggle="tooltip"]').tooltip()
		});
		
		$.ajax("http://trebolbit.mx/cambio_climatico/data/page1Structure.json", {
		    success: function(data){
			    //alert(JSON.stringify(data));
			    var item1 = data.item1;
					$("#green-boxes").append('<div id="item1" class="side-box custom-tooltip" data-toggle="tooltip" data-placement="bottom" title="'+item1.tooltipDescription+'"><div class="box-image"><div class="images-margin-side"><img class="img-responsive" src="'+item1.imageUrl+'"></div></div><div class="box-text"><p class=" text-size-14"><span style="font-size:22px">'+item1.highlight+'</span> '+item1.description+'</p></div></div>');

			    var item2 = data.item2;
					$("#green-boxes").append('<div id="item2" class="side-box custom-tooltip" data-toggle="tooltip" data-placement="top" title="'+item2.tooltipDescription+'"><div class="box-image"><div class="images-margin-side"><img class="img-responsive" src="'+item2.imageUrl+'"></div></div><div class="box-text"><p class=" text-size-14"><span style="font-size:22px">'+item2.highlight+'</span> '+item2.description+'</p></div></div>');

			    var item3 = data.item3;
					$("#green-boxes").append('<div id="item3" class="side-box custom-tooltip" data-toggle="tooltip" data-placement="top" title="'+item3.tooltipDescription+'"><div class="box-image"><div class="images-margin-side"><img class="img-responsive" src="'+item3.imageUrl+'"></div></div><div class="box-text"><p class=" text-size-14"><span style="font-size:22px">'+item3.highlight+'</span> '+item3.description+'</p></div></div>');
		    },
		    error: function(err){
			    alert(JSON.stringify(err));
		    }		    
		});

		
		$.ajax("http://trebolbit.mx/cambio_climatico/data/data.csv", {
		    success: function(data) {

		        var jsonobject = csvjson.csv2json(data);
		        		        

		        var totalrows = jsonobject.rows.length;
				
				var sector = [];

				sector[0]= {
					name:jsonobject.rows[0].a_Categoria_IPCC,
				};

				if(jsonobject.rows[0].a_2012 > 0){
					sector[0].total += jsonobject.rows[0].a_2012;
				}else{
					sector[0].total = 0;
				};

				if(jsonobject.rows[0].a_2012 < 0){
					
					sector[0].total_2 += (jsonobject.rows[0].a_2012)*(-1);
				}else{
					sector[0].total_2 = 0;
				}				
				

		        var sectorIndex = 0					

		        for(i=0; i<totalrows; i++){
					
					var actualSector = jsonobject.rows[i].a_Categoria_IPCC;
					
					if(jsonobject.rows[i].a_2012 > 0){
						sector[sectorIndex].total += jsonobject.rows[i].a_2012;						
					}
					if(jsonobject.rows[i].a_2012 < 0){
						sector[sectorIndex].total_2 += (jsonobject.rows[i].a_2012)*(-1);
					}					
					
			        if(sector[sectorIndex].name != jsonobject.rows[i].a_Categoria_IPCC){
				        	
				        sectorIndex += 1;
						sector[sectorIndex] = {
							name:jsonobject.rows[i].a_Categoria_IPCC,
							total:jsonobject.rows[i].a_2012							
						};
						
						if(jsonobject.rows[i].a_2012 > 0){
							sector[sectorIndex].total = jsonobject.rows[i].a_2012;						
						}else{
							sector[sectorIndex].total = 0;
						};
						
						if(jsonobject.rows[i].a_2012 < 0){
							sector[sectorIndex].total_2 = (jsonobject.rows[i].a_2012)*(-1);
						}else{
							sector[sectorIndex].total_2 = 0;
						};						
						

			        }
		        }
		        //alert(JSON.stringify(sector));
		        
		        
			    var columns_adapted = [];
			    var groups_adapted = [];
			    groups_adapted[0] = [];			    
			    for(j=0; j<sector.length; j++){
				    columns_adapted[j]=[sector[j].name, sector[j].total,sector[j].total_2, sector[j].total - sector[j].total_2];
				    groups_adapted[0].push(sector[j].name);				    
			    };		        

				//alert(JSON.stringify(groups_adapted));		
				
				
				var chart1 = c3.generate({
					"bindto": "#chart1",			
				    data: {
				        columns: columns_adapted,
				        type: 'bar',
				        groups: groups_adapted
				    },
				    colors: {
			            "Agricultura": '#ff0000',
			            "Desechos": '#ff0000',
			            "Energía": '#ff0000'
			        }
				});				
					    

		    },
		    error: function() {
				alert("Error loading the chart data.");
		    }
		});	    		
			
	</script>  
	<script>
	
	var margin = {top: 20, right: 0, bottom: 0, left: 0},
	    width = 960,
	    height = 500 - margin.top - margin.bottom,
	    formatNumber = d3.format(",d"),
	    transitioning;
	
	var x = d3.scale.linear()
	    .domain([0, width])
	    .range([0, width]);
	
	var y = d3.scale.linear()
	    .domain([0, height])
	    .range([0, height]);
	
	var treemap = d3.layout.treemap()
	    .children(function(d, depth) { return depth ? null : d._children; })
	    .sort(function(a, b) { return a.value - b.value; })
	    .ratio(height / width * 0.5 * (1 + Math.sqrt(5)))
	    .round(false);
	
	var svg = d3.select("#chart-tree").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.bottom + margin.top)
	    .style("margin-left", -margin.left + "px")
	    .style("margin.right", -margin.right + "px")
	  .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
	    .style("shape-rendering", "crispEdges");
	
	var grandparent = svg.append("g")
	    .attr("class", "grandparent");
	
	grandparent.append("rect")
	    .attr("y", -margin.top)
	    .attr("width", width)
	    .attr("height", margin.top);
	
	grandparent.append("text")
	    .attr("x", 6)
	    .attr("y", 6 - margin.top)
	    .attr("dy", ".75em");
	
	d3.json("data/flare.json", function(root) {
	  initialize(root);
	  accumulate(root);
	  layout(root);
	  display(root);
	
	  function initialize(root) {
	    root.x = root.y = 0;
	    root.dx = width;
	    root.dy = height;
	    root.depth = 0;
	  }
	
	  // Aggregate the values for internal nodes. This is normally done by the
	  // treemap layout, but not here because of our custom implementation.
	  // We also take a snapshot of the original children (_children) to avoid
	  // the children being overwritten when when layout is computed.
	  function accumulate(d) {
	    return (d._children = d.children)
	        ? d.value = d.children.reduce(function(p, v) { return p + accumulate(v); }, 0)
	        : d.value;
	  }
	
	  // Compute the treemap layout recursively such that each group of siblings
	  // uses the same size (1×1) rather than the dimensions of the parent cell.
	  // This optimizes the layout for the current zoom state. Note that a wrapper
	  // object is created for the parent node for each group of siblings so that
	  // the parent’s dimensions are not discarded as we recurse. Since each group
	  // of sibling was laid out in 1×1, we must rescale to fit using absolute
	  // coordinates. This lets us use a viewport to zoom.
	  function layout(d) {
	    if (d._children) {
	      treemap.nodes({_children: d._children});
	      d._children.forEach(function(c) {
	        c.x = d.x + c.x * d.dx;
	        c.y = d.y + c.y * d.dy;
	        c.dx *= d.dx;
	        c.dy *= d.dy;
	        c.parent = d;
	        layout(c);
	      });
	    }
	  }
	
	  function display(d) {
	    grandparent
	        .datum(d.parent)
	        .on("click", transition)
	      .select("text")
	        .text(name(d));
	
	    var g1 = svg.insert("g", ".grandparent")
	        .datum(d)
	        .attr("class", "depth");
	
	    var g = g1.selectAll("g")
	        .data(d._children)
	      .enter().append("g");
	
	    g.filter(function(d) { return d._children; })
	        .classed("children", true)
	        .on("click", transition);
	
	    g.selectAll(".child")
	        .data(function(d) { return d._children || [d]; })
	      .enter().append("rect")
	        .attr("class", "child")
	        .call(rect);
	
	    g.append("rect")
	        .attr("class", "parent")
	        .call(rect)
	      .append("title")
	        .text(function(d) { return formatNumber(d.value); });
	
	    g.append("text")
	        .attr("dy", ".75em")
	        .text(function(d) { return d.name; })
	        .call(text);
	
	    function transition(d) {
	      if (transitioning || !d) return;
	      transitioning = true;
	
	      var g2 = display(d),
	          t1 = g1.transition().duration(750),
	          t2 = g2.transition().duration(750);
	
	      // Update the domain only after entering new elements.
	      x.domain([d.x, d.x + d.dx]);
	      y.domain([d.y, d.y + d.dy]);
	
	      // Enable anti-aliasing during the transition.
	      svg.style("shape-rendering", null);
	
	      // Draw child nodes on top of parent nodes.
	      svg.selectAll(".depth").sort(function(a, b) { return a.depth - b.depth; });
	
	      // Fade-in entering text.
	      g2.selectAll("text").style("fill-opacity", 0);
	
	      // Transition to the new view.
	      t1.selectAll("text").call(text).style("fill-opacity", 0);
	      t2.selectAll("text").call(text).style("fill-opacity", 1);
	      t1.selectAll("rect").call(rect);
	      t2.selectAll("rect").call(rect);
	
	      // Remove the old node when the transition is finished.
	      t1.remove().each("end", function() {
	        svg.style("shape-rendering", "crispEdges");
	        transitioning = false;
	      });
	    }
	
	    return g;
	  }
	
	  function text(text) {
	    text.attr("x", function(d) { return x(d.x) + 6; })
	        .attr("y", function(d) { return y(d.y) + 6; });
	  }
	
	  function rect(rect) {
	    rect.attr("x", function(d) { return x(d.x); })
	        .attr("y", function(d) { return y(d.y); })
	        .attr("width", function(d) { return x(d.x + d.dx) - x(d.x); })
	        .attr("height", function(d) { return y(d.y + d.dy) - y(d.y); });
	  }
	
	  function name(d) {
	    return d.parent
	        ? name(d.parent) + "." + d.name
	        : d.name;
	  }
	});






	
	
	</script>
  </body>	
</html>
